/*
 *  jQuery ZoomToo - v1.0.0
 *  Showcase your images with a magnifying lens on hover
 *  https://github.com/sevagf/zoomtoo
 *
 *  Made by Sevag Frankian
 *  Under MIT License
 */
(function(){!function(a){var b;b=function(a,b){this.element=a,this.load(b)},b.defaults={showDuration:500,moveDuration:1200,magnify:1,lensWidth:200,lensHeight:200},b.prototype={load:function(b){var c,d;d=this.element.find("img").first(),c=d.data("src"),this.element.one("zoomtoo.destroy",a.proxy(this.destroy,this)),c&&(this.mouseOnElement=!1,this.imgLoaded=!1,this.img=new Image,this.img.src=c,this.img.onload=a.proxy(this.initImage,this),this.element.css({cursor:"wait"}),this.init(b))},initImage:function(){var b,c;this.imgLoaded=!0,c=this.imgWidth,b=this.imgHeight,this.imgWidth=this.img.naturalWidth*this.settings.magnify,this.imgHeight=this.img.naturalHeight*this.settings.magnify,this.currentZoom.left=this.currentZoom.left-(this.imgWidth-c)/2,this.currentZoom.top=this.currentZoom.top-(this.imgHeight-b)/2,a(this.img).css({width:this.imgWidth,height:this.imgHeight}),this.element.css({cursor:"crosshair"}),this.mouseOnElement&&this.fadeInImage()},init:function(c){var d;d=this.element.css("position"),this.settings=a.extend({},b.defaults,c),this.element.get(0).style.position=/(absolute|fixed)/.test(d)?d:"relative",this.element.get(0).style.overflow="hidden",this.elementWidth=this.element.outerWidth(),this.elementHeight=this.element.outerHeight(),this.imgWidth=this.elementWidth,this.imgHeight=this.elementHeight,this.elementOffset=this.element.offset(),this.newZoom={left:0,top:0},this.currentZoom={left:0,top:0},this.moveImageTimer=0,this.continueSlowMove=!1,this.prepareElements()},prepareElements:function(){a(this.img).css({position:"absolute",top:0,left:0,opacity:0,width:this.imgWidth,height:this.imgHeight,border:"none",maxWidth:"none",maxHeight:"none"}).appendTo(this.element),this.element.on("mouseenter.zoomtoo",a.proxy(this.mouseEnter,this)).on("mouseleave.zoomtoo",a.proxy(this.mouseLeave,this)).on("mousemove.zoomtoo",a.proxy(this.mouseMove,this))},destroy:function(){this.cancelTimer(),this.element.off(),a(this.img).remove(),this.element.removeData("zoomtoo")},calculateOffset:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;d=a.x-this.elementOffset.left,e=a.y-this.elementOffset.top,h=Math.round(this.settings.lensHeight/2),i=Math.round(this.settings.lensWidth/2),m=e-h,j=e+h,k=d-i,l=d+i,0>m&&(e=h),j>this.elementHeight&&(e=this.elementHeight-h),0>k&&(d=i),l>this.elementWidth&&(d=this.elementWidth-i),f=this.imgHeight-this.elementHeight,b=this.elementHeight-this.settings.lensHeight,g=this.imgWidth-this.elementWidth,c=this.elementWidth-this.settings.lensWidth,o=-f/b*(e-h),n=-g/c*(d-i),this.newZoom.left=n,this.newZoom.top=o},cancelTimer:function(){clearTimeout(this.moveImageTimer)},stopSlowMoveImage:function(){this.continueSlowMove=!1},mouseLeave:function(){this.mouseOnElement=!1,a(this.img).stop().fadeTo(this.settings.showDuration,0).promise().done(this.stopSlowMoveImage)},mouseEnter:function(a){var b;this.mouseOnElement=!0,b={x:a.pageX,y:a.pageY},this.calculateOffset(b),this.continueSlowMove=!0,this.currentZoom.top=this.newZoom.top,this.currentZoom.left=this.newZoom.left,this.moveImage(),this.imgLoaded&&this.fadeInImage()},fadeInImage:function(){a(this.img).stop().fadeTo(this.settings.showDuration,1)},mouseMove:function(a){var b;b={x:a.pageX,y:a.pageY},this.calculateOffset(b),this.cancelTimer(),this.continueSlowMove=!0,this.slowMoveImage()},slowMoveImage:function(){var b,c,d,e;b={left:0,top:0},c={left:0,top:0},d=!1,e=!1,b.left=this.newZoom.left-this.currentZoom.left,b.top=this.newZoom.top-this.currentZoom.top,c.left=-b.left/(this.settings.moveDuration/100),c.top=-b.top/(this.settings.moveDuration/100),this.currentZoom.left=this.currentZoom.left-c.left,this.currentZoom.top=this.currentZoom.top-c.top,Math.abs(b.left)<1&&(this.currentZoom.left=this.newZoom.left,d=!0),Math.abs(b.top)<1&&(this.currentZoom.top=this.newZoom.top,e=!0),this.moveImage(),d&&e&&(this.continueSlowMove=!1),this.continueSlowMove===!0&&(this.moveImageTimer=setTimeout(a.proxy(this.slowMoveImage,this),25))},moveImage:function(){this.img.style.left=this.currentZoom.left+"px",this.img.style.top=this.currentZoom.top+"px"}},a.fn.zoomToo=function(c){this.each(function(){var d;d=a.data(this,"zoomtoo"),d||a.data(this,"zoomtoo",new b(a(this),c))})}}(window.jQuery)}).call(this);